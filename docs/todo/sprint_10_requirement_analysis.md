# Сбор требований сервиса нотификаций - 10 спринт

## Системные

1. Проект должен интегрироваться в текущую программную инфраструктуру, которая включает в себя:
    - Панель администратора.
    - ETL из postgres в ElasticSearch.
    - Сервис выдачи контента.
    - Сервис авторизации.
    - UGC API для сбора пользовательских дейтсвий.

Один из главных компонентов системы уведомлений — процесс (или процессы в случае масштабирования системы), который может принимать события и отправлять уведомления. Этим процессом может быть API. 

## Функциональные

Основные сущности проекта:
 - Уведомление.
 - Событие.
 - Пользователь.

Основные компоненты системы:
- API для приёма событий для создания уведомлений;
- Процесс, который отправляет уведомление (воркер);
- Генератор автоматических событий;
- Админ-панель;
- Планировщик (или [Cron](https://ru.wikipedia.org/wiki/Cron));
- БД для хранения уведомлений;

### Возможные сценарии

**Сценарий 1. Единичное событие:**
 * Мгновенное:
    1. UGC система, которая обрабатывает мгновенное событие, отправляет запрос в API о новом событии.
    2. API передаёт информацию о событии в воркер.
    3. Воркер отправляет уведомление пользователю.

    Данные для уведомления о мгновенном событии передаются в API из UGC.

    Примеры мгновенных событий: выход новой серии, подтверждение регистрации, чек об оплате.

 * Отложенное:
    1. UGC система, которая обрабатывает отложенное событие, отправляет запрос в API о новом событии.
    2. API сохраняет информацию о событии в БД, в которой хранятся все уведомления по событиям.
    3. Планировщик с определенной периодичностью генерирует события на основе данных в БД и отправляет их в воркер.

    Данные для уведомления об отложенном событии передаются в API из UGC.

    Примеры отложенных событий: лайки к комментарию пользователя (за сутки может накопиться сотня лайков и нецелесообразно каждый раз уведомлять о новом лайке).

**Сценарий 2. Периодическое событие:**
1. Генератор автоматических событий создаёт периодическое событие, например `еженедельная рассылка`, и отправляет его в API.
2. API передаёт информацию о событии в воркер.
3. Воркер отправляет уведомление пользователю.

    Данные для уведомления собирает и передаёт в API генератор событий.

**Сценарий 3. Ручная рассылка от менеджера:**
1. Админ-панель создаёт рассылку и отправляет запрос в API о новом событии.
2. API передаёт информацию о событии в воркер.
3. Воркер отправляет уведомление пользователю.

    Данные для уведомления собирает и передаёт в API админ-панель.

**Сценарий 4. Управление уведомлениями:**
1. Пользователь заходит в личный кабинет и включает/выключает отправку ему уведомлений.
2. Сервис нотификации с учетом пожеланий пользователя производит отправку уведомлений.

**Ключевые выводы:**
1. API системы нотификации ничего не знает про UGC, а получает события в готовом виде для дальнейшей передачи в воркер.
2. Событие может быть создано различными компонентами текущей системы.


## Нефункциональные

1. Приложение должно быть...